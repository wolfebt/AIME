<!--
    File: scene.html
    Reference: Scene Builder
    Creator: Wolfe.BT, TangentLLC
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIME - Scene Builder</title>
    <link rel="stylesheet" href="../style/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="../script/global-ui.js"></script>
    <script src="../script/element-bundle.js"></script>
</head>
<body>
    <header class="main-header">
        <div class="header-left">
            <a href="../index.html" class="logo-title animated-gradient">AIME</a>
            <button id="settings-btn" class="settings-btn" title="API Key Settings">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
        </div>
        <nav class="main-nav">
            <a href="elements.html" class="active">Elements</a>
            <a href="writer.html">Writer</a>
            <a href="imaging.html">Imaging</a>
        </nav>
    </header>

    <main class="container">
        <div class="element-header">
            <h2 class="element-title animated-gradient">Scene Builder</h2>
            <div class="header-actions">
                <p class="element-subtitle">Construct the narrative beats of a single scene.</p>
            </div>
        </div>
        <div class="workspace-layout">
            <div class="main-column">
                <div class="element-nav glass-panel">
                    <button class="element-nav-button active" data-tab="core">Core Elements</button>
                    <button class="element-nav-button" data-tab="setting">Setting & Atmosphere</button>
                    <button class="element-nav-button" data-tab="characters">Characters & POV</button>
                    <button class="element-nav-button" data-tab="plot">Plot & Pacing</button>
                    <button class="element-nav-button" data-tab="sensory">Sensory & Dialogue</button>
                    <button class="element-nav-button" data-tab="checklist">Checklist</button>
                </div>

                <!-- Core Elements Tab -->
                <div id="core-tab" class="element-tab active">
                    <div class="form-section glass-panel">
                        <div class="form-group"><label for="scene-title">Scene Title / Working Name</label><input type="text" id="scene-title" class="input-field" data-field-id="title" placeholder="e.g., 'The Confrontation in the Rain,' 'First Contact'" autocomplete="off"></div>
                        <div class="form-group"><label for="scene-placement">Placement in Story</label><input type="text" id="scene-placement" class="input-field" data-field-id="placement" placeholder="Act, Sequence, Chapter" autocomplete="off"></div>
                        <div class="form-group"><label for="scene-summary">One-Sentence Summary</label><textarea id="scene-summary" class="input-field" data-field-id="summary" placeholder="What is the single most important event or revelation in this scene?"></textarea></div>
                        <div class="form-group"><label for="scene-purpose">Scene Goal / Purpose</label><textarea id="scene-purpose" class="input-field" data-field-id="purpose" placeholder="Why does this scene exist? (e.g., To reveal a clue, introduce a character, escalate the central conflict)"></textarea></div>
                        <div class="form-group"><label for="scene-beginning-state">Beginning State</label><textarea id="scene-beginning-state" class="input-field" data-field-id="beginning_state" placeholder="What is the status quo for the characters and plot at the start of the scene?"></textarea></div>
                        <div class="form-group"><label for="scene-ending-state">Ending State</label><textarea id="scene-ending-state" class="input-field" data-field-id="ending_state" placeholder="What has fundamentally changed by the end of the scene? (This is the measure of its success)"></textarea></div>
                    </div>
                </div>

                <!-- Setting & Atmosphere Tab -->
                <div id="setting-tab" class="element-tab hidden">
                    <div class="form-section glass-panel">
                        <div class="form-group"><label for="setting-location">Location</label><input type="text" id="setting-location" class="input-field" data-field-id="location" placeholder="Be specific: 'The dimly lit corner booth of the Red Dragon tavern,' not just 'a bar'" autocomplete="off"></div>
                        <div class="form-group"><label for="setting-time">Time of Day / Date</label><input type="text" id="setting-time" class="input-field" data-field-id="time" placeholder="" autocomplete="off"></div>
                        <div class="form-group"><label for="setting-weather">Weather / Environment</label><textarea id="setting-weather" class="input-field" data-field-id="weather" placeholder=""></textarea></div>
                        <div class="form-group"><label for="setting-atmosphere">Atmosphere & Mood</label><textarea id="setting-atmosphere" class="input-field" data-field-id="atmosphere" placeholder="What is the intended feeling? (e.g., Tense, somber, mysterious, romantic, chaotic)"></textarea></div>
                        <div class="form-group"><label for="setting-props">Key Props & Objects</label><textarea id="setting-props" class="input-field" data-field-id="props" placeholder="What items in the setting are crucial for the action, plot, or symbolism?"></textarea></div>
                    </div>
                </div>

                <!-- Characters & POV Tab -->
                <div id="characters-tab" class="element-tab hidden">
                    <div class="form-section glass-panel">
                        <div class="form-group"><label for="characters-pov">Point of View (POV) Character</label><input type="text" id="characters-pov" class="input-field" data-field-id="pov_character" placeholder="From whose perspective is the scene told?" autocomplete="off"></div>
                        <div class="form-group"><label for="characters-present">Characters Present</label><textarea id="characters-present" class="input-field" data-field-id="characters_present" placeholder="List all characters physically in the scene and any others who are significantly mentioned."></textarea></div>
                        <div class="form-group"><label for="characters-pov-goal">POV Character's Goal</label><textarea id="characters-pov-goal" class="input-field" data-field-id="pov_goal" placeholder="What do they want to achieve in this scene? (e.g., 'To get a confession,' 'To escape unnoticed')"></textarea></div>
                        <div class="form-group"><label for="characters-opposing-goal">Opposing Character's Goal</label><textarea id="characters-opposing-goal" class="input-field" data-field-id="opposing_goal" placeholder="What does the primary antagonist/obstacle in the scene want?"></textarea></div>
                        <div class="form-group"><label for="characters-emotional-arc">Emotional Arc</label><textarea id="characters-emotional-arc" class="input-field" data-field-id="emotional_arc" placeholder="How does the POV character's emotional state change from the beginning to the end of the scene?"></textarea></div>
                    </div>
                </div>

                <!-- Plot & Pacing Tab -->
                <div id="plot-tab" class="element-tab hidden">
                     <div class="form-section glass-panel">
                        <div class="form-group"><label for="plot-opening-beat">Opening Beat</label><textarea id="plot-opening-beat" class="input-field" data-field-id="opening_beat" placeholder="How does the scene begin? What is the first image, action, or line of dialogue?"></textarea></div>
                        <div class="form-group"><label for="plot-sequence">Sequence of Events</label><textarea id="plot-sequence" class="input-field" data-field-id="sequence" placeholder="A bulleted list of the major actions and turning points."></textarea></div>
                        <div class="form-group"><label for="plot-inciting-incident">Inciting Incident</label><textarea id="plot-inciting-incident" class="input-field" data-field-id="inciting_incident" placeholder="The event that kicks off the scene's central conflict."></textarea></div>
                        <div class="form-group"><label for="plot-rising-action">Rising Action</label><textarea id="plot-rising-action" class="input-field" data-field-id="rising_action" placeholder="How does the conflict escalate? What obstacles arise?"></textarea></div>
                        <div class="form-group"><label for="plot-climax">Climax/Turning Point</label><textarea id="plot-climax" class="input-field" data-field-id="climax" placeholder="The moment of highest tension where the outcome is decided."></textarea></div>
                        <div class="form-group"><label for="plot-resolution">Resolution / Aftermath</label><textarea id="plot-resolution" class="input-field" data-field-id="resolution" placeholder="How does the scene end? What is the immediate consequence of the climax?"></textarea></div>
                        <div class="form-group"><label for="plot-pacing">Pacing</label><input type="text" id="plot-pacing" class="input-field" data-field-id="pacing" placeholder="e.g., Fast and frantic, slow and deliberate, reflective and quiet" autocomplete="off"></div>
                        <div class="form-group"><label for="plot-conflict-type">Conflict Type</label><input type="text" id="plot-conflict-type" class="input-field" data-field-id="conflict_type" placeholder="e.g., Character vs. Character, Character vs. Self, Character vs. Environment" autocomplete="off"></div>
                    </div>
                </div>

                <!-- Sensory Details & Dialogue Tab -->
                <div id="sensory-tab" class="element-tab sub-tab-container hidden">
                    <div class="sub-nav glass-panel">
                        <button class="sub-nav-button active" data-sub-tab="sensory-details">Sensory Details</button>
                        <button class="sub-nav-button" data-sub-tab="dialogue">Dialogue</button>
                    </div>
                    <div id="sensory-details-sub-tab" class="sub-tab-content active">
                        <div class="form-section glass-panel">
                            <div class="form-group"><label for="sensory-visuals">Visuals</label><textarea id="sensory-visuals" class="input-field" data-field-id="visuals" placeholder="What are the most important things the POV character sees? (Light, color, shadow, movement)"></textarea></div>
                            <div class="form-group"><label for="sensory-sounds">Sounds</label><textarea id="sensory-sounds" class="input-field" data-field-id="sounds" placeholder="What does the character hear? (Dialogue, background noise, significant sound effects)"></textarea></div>
                            <div class="form-group"><label for="sensory-smells">Smells & Tastes</label><textarea id="sensory-smells" class="input-field" data-field-id="smells" placeholder="What scents are in the air? Are any tastes relevant?"></textarea></div>
                            <div class="form-group"><label for="sensory-tactile">Tactile Sensations</label><textarea id="sensory-tactile" class="input-field" data-field-id="tactile" placeholder="What does the character physically feel? (Temperature, textures, pain, pleasure)"></textarea></div>
                            <div class="form-group"><label for="sensory-symbolism">Dominant Imagery / Symbolism</label><textarea id="sensory-symbolism" class="input-field" data-field-id="symbolism" placeholder="Is there a recurring image or symbol used in the scene?"></textarea></div>
                        </div>
                    </div>
                    <div id="dialogue-sub-tab" class="sub-tab-content hidden">
                        <div class="form-section glass-panel">
                            <div class="form-group"><label for="dialogue-key-lines">Key Lines of Dialogue</label><textarea id="dialogue-key-lines" class="input-field" data-field-id="key_lines" placeholder="What are the most impactful or informative things said?"></textarea></div>
                            <div class="form-group"><label for="dialogue-subtext">Subtext</label><textarea id="dialogue-subtext" class="input-field" data-field-id="subtext" placeholder="What is being communicated without being said directly? What are the underlying tensions, desires, or secrets?"></textarea></div>
                            <div class="form-group"><label for="dialogue-tone">Tone of Dialogue</label><input type="text" id="dialogue-tone" class="input-field" data-field-id="tone" placeholder="e.g., Witty, aggressive, formal, sarcastic, pleading" autocomplete="off"></div>
                        </div>
                    </div>
                </div>

                <!-- Scene Checklist Tab -->
                <div id="checklist-tab" class="element-tab hidden">
                    <div class="form-section glass-panel">
                        <div class="form-group"><label for="checklist-advances-plot">Does this scene advance the plot?</label><textarea id="checklist-advances-plot" class="input-field" data-field-id="advances_plot" placeholder="Yes/No. If yes, how?"></textarea></div>
                        <div class="form-group"><label for="checklist-reveals-character">Does this scene reveal new information about a character?</label><textarea id="checklist-reveals-character" class="input-field" data-field-id="reveals_character" placeholder="Yes/No. If yes, what?"></textarea></div>
                        <div class="form-group"><label for="checklist-has-conflict">Does this scene contain meaningful conflict?</label><textarea id="checklist-has-conflict" class="input-field" data-field-id="has_conflict" placeholder="Yes/No. If yes, what is it?"></textarea></div>
                        <div class="form-group"><label for="checklist-has-hook">Does the scene end with a hook or question?</label><textarea id="checklist-has-hook" class="input-field" data-field-id="has_hook" placeholder="Does it make the reader want to continue?"></textarea></div>
                        <div class="form-group"><label for="checklist-clear-pov">Is the POV clear and consistent throughout?</label><input type="text" id="checklist-clear-pov" class="input-field" data-field-id="clear_pov" placeholder="Yes/No" autocomplete="off"></div>
                    </div>
                </div>

                <div id="response-container" class="response-container glass-panel" contenteditable="true"></div>
            </div>
            <div class="resize-handle"></div>
            <div class="side-column">
                <div class="accordion glass-panel active">
                    <button class="accordion-header active">
                        <span>Generation Controls</span>
                        <svg class="accordion-chevron" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content">
                        <div class="generation-controls-buttons">
                            <button id="generate-button" data-element-type="SCENE" class="generate-btn-large">Generate</button>
                            <button id="iterate-button" class="generate-btn-large hidden">Iterate</button>

                            <div id="update-field-container" class="form-group hidden">
                                <label for="update-instructions">Update Instructions</label>
                                <textarea id="update-instructions" class="input-field" placeholder="e.g., Make the dialogue more tense..."></textarea>
                            </div>

                            <div class="generation-controls-row">
                                <button id="save-prompt-button" class="action-btn">Save Prompt</button>
                                <button id="save-content-button" class="action-btn">Save Content</button>
                            </div>

                            <div class="generation-controls-row">
                                <button id="load-button" class="action-btn">Load</button>
                                <button id="new-button" class="action-btn">New</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="side-panel-container">
                    <div class="accordion glass-panel">
                        <button class="accordion-header">
                            <span>Guidance</span>
                            <svg class="accordion-chevron" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div id="guidance-gems-container"></div>
                        </div>
                    </div>
                    <div class="asset-hub-panel glass-panel">
                        <h3 class="side-panel-title">Asset Hub</h3>
                        <div class="asset-hub-container">
                            <p class="asset-hub-subtitle">Import files to provide contextual reference for this Scene.</p>
                            <div class="asset-import-area">
                                <input type="file" id="asset-upload" multiple="" style="display: none;">
                                <button id="import-asset-btn" class="import-btn">Import Asset(s)</button>
                            </div>
                            <div id="asset-list" class="asset-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Floating Text Toolbar -->
    <div id="text-toolbar" class="glass-panel hidden">
        <button class="toolbar-btn" data-action="rephrase">Rephrase</button>
        <button class="toolbar-btn" data-action="shorten">Shorten</button>
        <button class="toolbar-btn" data-action="expand">Expand</button>
        <button class="toolbar-btn" data-action="custom">Custom...</button>
        <div id="custom-prompt-container" class="hidden">
            <input type="text" id="custom-prompt-input" placeholder="e.g., make this more dramatic">
            <button id="custom-prompt-submit">Go</button>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container"></div>

    <!-- Settings Modal -->
    <div id="settings-modal-overlay" class="modal-overlay hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3>API Key Settings</h3>
                <button id="modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>Please enter your Gemini API key below. This key will be stored securely in your browser's local storage.</p>
                <div class="form-group">
                    <label for="api-key-input">Gemini API Key</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="api-key-input" class="input-field" placeholder="Enter your API key">
                        <button id="view-api-key" class="view-api-key-btn" title="Show/Hide Key">👁</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-save-btn" class="generate-btn-large">Save Key</button>
            </div>
        </div>
    </div>

    <!-- Guidance Selection Modal -->
    <div id="gem-selection-modal-overlay" class="modal-overlay hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h3 id="gem-modal-title">Select Options</h3>
                <button id="gem-modal-close-btn" class="modal-close-btn">&times;</button>
            </div>
            <div id="gem-modal-options-container" class="modal-body">
                <!-- Clickable option buttons will be dynamically inserted here -->
            </div>
            <div class="gem-modal-custom-input-area">
                <input type="text" id="custom-gem-input" class="input-field" placeholder="Add a custom option...">
                <button id="add-custom-gem-btn" class="action-btn">Add</button>
            </div>
            <div class="modal-footer">
                <button id="gem-modal-save-btn" class="generate-btn-large">Save Selections</button>
            </div>
        </div>
    </div>
</body>
</html>